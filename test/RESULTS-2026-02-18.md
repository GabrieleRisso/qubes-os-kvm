# Test Results — 2026-02-18

**Environment:** `visyble` AppVM (Arch Linux) inside Qubes OS 4.3
**Host CPU:** Intel Core Ultra 9 275HX (Arrow Lake), nested HVM enabled
**Test method:** Local execution + `qubes-remote` probes to `kvm-dev` StandaloneVM

## Summary

| Suite | Passed | Failed | Skipped | Total |
|-------|--------|--------|---------|-------|
| **Granular Probes (P0–P4)** | 16 | 0 | 0 | 16 |
| **kvm-backend-tests.sh** | 48 | 0 | 4 | 52 |
| **e2e Tier 1 (Build Environment)** | 43 | 0 | 1 | 44 |
| **e2e Tier 3 (ARM64 Full Suite)** | 137 | 0 | 0 | 137 |
| **run-tests.sh (Project Structure)** | 6 tests, 0 fail | | | 6 |
| **TOTAL** | **250** | **0** | **5** | **255** |

**Result: ALL TESTS PASSED (5 skips are non-blocking)**

Skips:
- 4× `docutils` Python dependency not installed (KvmMemoryMixin import tests — code verified via other paths)
- 1× `createrepo_c` not installed (optional RPM repo tool)

e2e Tier 2 (KVM + Xen HVM emulation) requires `/dev/kvm` — previously validated in kvm-dev: 16/16 PASS (see Granular Probes below).

---

## P0: Foundation (KVM + QEMU core) — 4/4 PASS

| # | Test | Result | Detail |
|---|------|--------|--------|
| P0.1 | /dev/kvm exists, read-write | **PASS** | `crw-rw-rw- root:kvm 10,232` |
| P0.2 | KVM kernel module | **PASS** | `kvm_intel` (561KB) + `kvm` (1.5MB) + `irqbypass` |
| P0.3 | QEMU binary | **PASS** | `qemu-system-x86_64` 9.2.4 (Fedora 42) + `qemu-img` |
| P0.4 | KVM acceleration | **PASS** | `-accel kvm -cpu host` accepted, no errors |

---

## P1: Build Chain (native + cross) — 4/4 PASS

| # | Test | Result | Detail |
|---|------|--------|--------|
| P1.1 | Native C compile + exec | **PASS** | GCC 15.2.1 (Red Hat 15.2.1-7) |
| P1.2 | Native Rust compile + exec | **PASS** | rustc 1.93.0 (Fedora 1.93.0-1.fc42) |
| P1.3 | ARM64 cross-compile | **PASS** | `aarch64-linux-gnu-gcc` 15.2.1 → ELF 64-bit ARM aarch64, statically linked |
| P1.4 | ARM64 user-mode execution | **PASS** | `qemu-aarch64-static` 9.2.4 runs aarch64 binary, outputs `ARM64_OK` |

---

## P2: Xen-on-KVM Emulation (core architecture) — 4/4 PASS

| # | Test | Result | Detail |
|---|------|--------|--------|
| P2.1 | QEMU Xen accelerator | **PASS** | `qemu-system-x86_64 -accel help` lists: `tcg`, `xen`, `kvm` |
| P2.2 | Xen HVM emulation | **PASS** | `-accel kvm,xen-version=0x40013,kernel-irqchip=split` accepted (Xen 4.19) |
| P2.3 | Xen device emulation | **PASS** | `xen-console` device + `if=xen` disk + Xen HVM accel — all accepted |
| P2.4 | OVMF UEFI firmware | **PASS** | `/usr/share/edk2/ovmf/OVMF_CODE.fd` (1.9MB) |

---

## P3: ARM64 System Emulation (Snapdragon target) — 3/3 PASS

| # | Test | Result | Detail |
|---|------|--------|--------|
| P3.1 | qemu-system-aarch64 | **PASS** | Version 9.2.4 at `/usr/bin/qemu-system-aarch64` |
| P3.2 | ARM64 virt machine | **PASS** | `-M virt -cpu cortex-a76 -m 256` accepted, runs until timeout |
| P3.3 | ARM64 UEFI firmware | **PASS** | `/usr/share/edk2/aarch64/QEMU_EFI.fd` (3.0MB) |

---

## P4: Container + CI Environment — 1/1 PASS (1 note)

| # | Test | Result | Detail |
|---|------|--------|--------|
| P4.1 | Podman | **PASS** | 5.7.1 |
| P4.1 | virsh (libvirt) | **PASS** | 11.0.0 — **NOTE: libvirtd not running** (start when needed) |
| P4.1 | rpmbuild | **PASS** | RPM 4.20.1 |
| P4.1 | createrepo_c | **PASS** | 1.2.0 |
| P4.1 | Project structure | **PASS** | Makefile + scripts/ (11 .sh files) + test/ + configs/ |

---

## KVM Backend Integration Tests (kvm-backend-tests.sh) — 48/48 PASS

| Section | Tests | Result |
|---------|-------|--------|
| 1. Libvirt XML template structure | 24 | 24 PASS (kvm, kvm-xenshim, kvm-aarch64, kvm-aarch64-xenshim) |
| 2. Python module imports | 2 | 2 SKIP (docutils dependency) |
| 3. KvmMemoryMixin API surface | 1 | 1 SKIP (docutils dependency) |
| 4. Backend VMM guards in qubesvm.py | 8 | 8 PASS |
| 5. QubesHost dual-backend in app.py | 3 | 3 PASS |
| 6. QubesDB config injection tools | 5 | 5 PASS (sources + Makefile + compiled binaries) |
| 7. Python syntax validation | 4 | 4 PASS |
| 8. Jinja2 template syntax | 4 | 4 PASS |
| 9. KvmMemoryMixin signatures | 1 | 1 SKIP (docutils dependency) |

---

## e2e Tier 1: Build Environment — 43/43 PASS

| Section | Tests | Result |
|---------|-------|--------|
| 1.1–1.5: Core build tools | 12 | 12 PASS (gcc, g++, make, cmake, git, python3, cargo, rustc, podman, C, Rust) |
| 1.6: Project structure | 14 | 14 PASS (Makefile + all 11 scripts syntax OK) |
| 1.7: RPM build tools | 2 | 1 PASS, 1 SKIP (createrepo_c optional) |
| 1.8: vchan-socket build | 3 | 3 PASS (clean build, symbol export, pkgconfig) |
| 1.9: vchan-socket tests | 1 | 1 PASS (42 unit tests) |
| 1.10: qubesdb-config KVM tools | 2 | 2 PASS (inject + read build clean) |
| 1.11: Agent KVM scripts | 5 | 5 PASS (syntax + ShellCheck) |
| 1.12: RPM spec conditionals | 4 | 4 PASS (macros, spec provides/conflicts, builder config) |

---

## e2e Tier 3: ARM64 Full Suite — 137/137 PASS

| Section | Tests | Result |
|---------|-------|--------|
| 3.1: Cross-compilation toolchain | 12 | 12 PASS (gcc, QEMU, user-mode, UEFI, freestanding, sysroot, Rust) |
| 3.2: ARM64 kernel configs | 49 | 49 PASS (base-aarch64, qubes-aarch64, kvm-aarch64, kernel.spec, gen-config) |
| 3.3: Libvirt templates | 29 | 29 PASS (kvm-aarch64, kvm-aarch64-xenshim, pci-kvm-aarch64, config.py, __init__.py) |
| 3.4: Hypervisor detection | 9 | 9 PASS (agent + udev: ARM64, DT, PSCI, no x86 cpuid) |
| 3.5: Builder config & boot chain | 14 | 14 PASS (aarch64 builder yml, GRUB configs, ARM console) |
| 3.6: crosvm ARM64 launch script | 10 | 10 PASS (syntax, GIC, vsock, GPU, QubesDB, Xen shim) |
| 3.7: QEMU ARM64 boot tests | 8 | 8 PASS (virt, GICv3, UEFI, virtio, vm-launch.sh) |
| 3.8: Build & boot integration | 6 | 6 PASS (vchan cross, qubesdb cross, Rust cross, kernel Image, full boot 11/11 in-VM) |

---

## Software Versions

### visyble (Arch Linux AppVM — test runner)

| Component | Version |
|-----------|---------|
| GCC (native) | 15.2.1 20260209 |
| GCC (aarch64 cross) | 15.1.0 |
| Rust | 1.93.1 (Arch 1:1.93.1-1) |
| Cargo | 1.93.1 |
| Python | 3.14.2 |
| Podman | 5.7.1 |
| RPM | 4.20.1 |
| Git | 2.53.0 |
| CMake | 4.2.3 |
| Make | 4.4.1 |
| QEMU (system) | 10.2.0 |
| QEMU (user) | 10.2.0 (qemu-aarch64-static) |
| OVMF aarch64 | /usr/share/edk2/aarch64/QEMU_EFI.fd (3.0M) |

### kvm-dev (Fedora 42 StandaloneVM — KVM tests)

| Component | Version |
|-----------|---------|
| QEMU | 9.2.4 (qemu-9.2.4-2.fc42) |
| GCC (native) | 15.2.1 (Red Hat 15.2.1-7) |
| GCC (aarch64 cross) | 15.2.1 (Red Hat Cross 15.2.1-1) |
| Rust | 1.93.0 (Fedora 1.93.0-1.fc42) |
| Python | 3.13.11 |
| Podman | 5.7.1 |
| libvirt/virsh | 11.0.0 |
| KVM module | kvm_intel 561152 bytes |
| Xen emulation | QEMU xen-version=0x40013 (Xen 4.19) |
| OVMF x86_64 | /usr/share/edk2/ovmf/OVMF_CODE.fd (1.9M) |
| OVMF aarch64 | /usr/share/edk2/aarch64/QEMU_EFI.fd (3.0M) |

---

## Known Issues / Notes

1. **libvirtd not running in kvm-dev** — Start with `sudo systemctl start libvirtd` when needed for virsh management
2. **qubes-remote dom0 daemon** — Can become unresponsive; restart with `sudo systemctl restart qvm-remote-dom0`
3. **docutils dependency** — `python3-docutils` not installed in visyble; causes 4 SKIP in kvm-backend-tests (not a code issue)
4. **createrepo_c** — Not installed in visyble (Arch); only needed for local RPM repo creation

---

## Test Scripts

- **Granular probes:** `test/granular-probes.sh [p0|p1|p2|p3|p4|all]`
- **KVM backend:** `test/kvm-backend-tests.sh [core-admin-path]`
- **Full e2e suite:** `test/e2e-tiers.sh [tier1|tier2|tier3|all]`
- **ARM64 full:** `test/tier3-arm64.sh [tools|configs|templates|hypervisor|builder|crosvm|boot|buildboot|all]`
- **Project structure:** `test/run-tests.sh [workspace-path]`
